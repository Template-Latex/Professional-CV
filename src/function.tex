% Template:     Professional-CV
% Documento:    Funciones utilitarias
% Versión:      3.3.3 (30/10/2023)
% Codificación: UTF-8
%
% Autor: Pablo Pizarro R.
%        pablo@ppizarror.com
%
% Manual template: [https://latex.ppizarror.com/professional-cv]
% Licencia MIT:    [https://opensource.org/licenses/MIT]

% Definición de variables globales
\global\def\GLOBALheaderfaimport {false}
\global\def\GLOBALheaderlineitem {false}
\global\def\GLOBALheaderseparatorsticky {false}

\def\LOCALpercentchar#1{}
\edef\LOCALpercentchar{\expandafter\LOCALpercentchar\string\%}

% Archivo que guarda el código del header
\newwrite\fileheaderitems
\immediate\openout\fileheaderitems=\jobname.hitems
\AtBeginDocument{\immediate\closeout\fileheaderitems}

% Espaciado necesario para printifspace
\newcommand*\measurepage{\dimexpr\pagegoal-\pagetotal\relax}
\newsavebox{\printspacemybox}
\newlength{\printspaceboxheight}

% Inserta un contenido dependiendo si posee el espacio mínimo necesario
%	#1	Tipo de decisión al no satisfacer el espacio necesario
%	#2	Tamaño mínimo (en baselineskip)
%	#2	Contenido
\newcommand{\printifspace}[3][np]{%
	\sbox{\printspacemybox}{\parbox{\textwidth}{\vspace{#2\baselineskip}#3}}%
	\setlength{\printspaceboxheight}{\ht\printspacemybox+\dp\printspacemybox}%
	\ifthenelse{\printspaceboxheight<\measurepage}{%
		#3%
	}{%
		\ifthenelse{\equal{#1}{ignore}}{ % No inserta el elemento
		}{%
		\ifthenelse{\equal{#1}{np}}{ % Lo inserta pero con una nueva página
			\newpage#3%
		}{%
		\ifthenelse{\equal{#1}{i}}{ % Nueva página
			\newpage%
		}{%
			\throwwarning{Valor paging incorrecto}%
		}}}%
	}%
}

% Lanza un mensaje de error
% 	#1	Función del error
%	#2	Mensaje
\newcommand{\throwerror}[2]{%
	\errmessage{LaTeX Error: \noexpand#1 #2 (linea \the\inputlineno)}%
	\stop%
}

% Lanza un mensaje de advertencia
%	#1	Mensaje
\newcommand{\throwwarning}[1]{%
	\errmessage{LaTeX Warning: #1 (linea \the\inputlineno)}%
}

% Lanza un mensaje de error indicando mala configuración
%	#1	Mensaje de error
% 	#2	Configuración usada
%	#3	Valores esperados
\newcommand{\throwbadconfig}[3]{%
	\errmessage{LaTeX Warning: #1 \noexpand #2=#2. Valores esperados: #3}%
	\stop%
}

% Lanza un mensaje de error indicando mala configuración dentro de begin{document}
%	#1	Mensaje de error
% 	#2	Configuración usada
%	#3	Valores esperados
\newcommand{\throwbadconfigondoc}[3]{%
	\errmessage{#1 \noexpand #2=#2. Valores esperados: #3}%
	\stop%
}

% Comprueba si una variable está definida
%	#1	Variable
\newcommand{\checkvardefined}[1]{%
	\ifthenelse{\isundefined{#1}}{%
		\errmessage{LaTeX Warning: Variable \noexpand#1 no definida}%
		\stop%
	}{}%
}

% Comprueba si una variable está definida
%	#1	Variable
%	#2	Mensaje
\newcommand{\checkextravarexist}[2]{%
	\ifthenelse{\isundefined{#1}}{%
		\errmessage{LaTeX Warning: Variable \noexpand#1 no definida}%
		\ifx\hfuzz#2\hfuzz%
			\errmessage{LaTeX Warning: Defina la variable en el bloque de INFORMACION DEL USUARIO al comienzo del archivo principal del Template}%
		\else%
			\errmessage{LaTeX Warning: #2}%
		\fi%
	}{}%
}

% Lanza un mensaje de error si una variable no ha sido definida
% 	#1	Función del error
%	#2	Variable
%	#3	Mensaje
\newcommand{\emptyvarerr}[3]{%
	\ifx\hfuzz#2\hfuzz%
		\errmessage{LaTeX Warning: \noexpand#1 #3 (linea \the\inputlineno)}%
	\fi%
}

% Cambia márgenes de las páginas [cm]
% 	#1	Margen izquierdo
%	#2	Margen superior
%	#3	Margen derecho
%	#4	Margen inferior
\newcommand{\setpagemargincm}[4]{%
	\ifthenelse{\equal{\compilertype}{lualatex}}{%
		% Geometry no válido en lualatex
	}{%
		\newgeometry{left=#1cm, top=#2cm, right=#3cm, bottom=#4cm}%
	}%
}

% Cambia los márgenes del documento
%	#1	Margen izquierdo
%	#2	Margen derecho
\newcommand{\changemargin}[2]{%
	\emptyvarerr{\changemargin}{#1}{Margen izquierdo no definido}%
	\emptyvarerr{\changemargin}{#2}{Margen derecho no definido}%
	\list{}{\rightmargin#2\leftmargin#1}\item[]%
}
\let\endchangemargin=\endlist

% Actualiza newcolumn
\ifthenelse{\isundefined{\newcolumn}}{%
	\newcommand{\newcolumn}{\columnbreak}
}{%
	\renewcommand{\newcolumn}{\columnbreak}
}

% Agrega el separador entre items del header
\newcommand{\addheaderseparator}{%
	\ifthenelse{\equal{\GLOBALheaderlineitem}{true}}{%
		\ifthenelse{\equal{\GLOBALheaderseparatorsticky}{false}}{%
			\immediate\write\fileheaderitems{\unexpanded{\textcolor{\headerseparatorcolor}{\headerseparator}}\LOCALpercentchar}%
		}{}%
	}{}%
	\global\def\GLOBALheaderlineitem {true}%
}

% Agrega un item de texto al header
%	#1	Texto
\newcommand{\addheadertext}[1]{%
	\global\def\GLOBALheaderseparatorsticky {false}%
	\addheaderseparator%
	\immediate\write\fileheaderitems{\unexpanded{\textcolor{\headertextcolor}{#1}}\LOCALpercentchar}%
}

% Agrega un correo al header
%	#1	Correo
\newcommand{\addheadermail}[1]{%
	\global\def\GLOBALheaderseparatorsticky {false}%
	\addheaderseparator%
	\immediate\write\fileheaderitems{\unexpanded{\href{mailto:#1}{#1}}\LOCALpercentchar}%
}

% Agrega un enlace al header
%	#1	Ícono de fontawesome, si está vacío se usa url normal
%	#2	Enlace
\newcommand{\addheaderlink}[2][]{%
	\ifthenelse{\equal{#1}{}}{ % Sin ícono
		\global\def\GLOBALheaderseparatorsticky {false}%
		\addheaderseparator%
		\immediate\write\fileheaderitems{\unexpanded{\url{#2}}\LOCALpercentchar}%
	}{%
		\addheaderseparator%
		\ifthenelse{\equal{\GLOBALheaderfaimport}{false}}{%
			\global\def\GLOBALheaderfaimport {true}%
			\usepackage{fontawesome5}%
		}{}%
		\ifthenelse{\equal{\GLOBALheaderseparatorsticky}{true}}{%
			\immediate\write\fileheaderitems{\unexpanded{\hspace{0.25cm}}\LOCALpercentchar}%
		}{}%
		\immediate\write\fileheaderitems{\unexpanded{\href{#2}{\faIcon{#1}}}\LOCALpercentchar}%
		\global\def\GLOBALheaderseparatorsticky {true}%
	}%
}

% Agrega una nueva línea al header
\newcommand{\addheadernewline}{%
	\global\def\GLOBALheaderlineitem {false}%
	\global\def\GLOBALheaderseparatorsticky {false}%
	\immediate\write\fileheaderitems{\unexpanded{\vspace{\headeritemslinespace cm}\\}\LOCALpercentchar}%
}

% Agrega un ícono
%	#1	Nombre del ícono
\newcommand{\addheadericon}[1]{%
	\ifthenelse{\equal{\GLOBALheaderfaimport}{false}}{%
		\global\def\GLOBALheaderfaimport {true}%
		\usepackage{fontawesome5}%
	}{}%
	\immediate\write\fileheaderitems{\unexpanded{\faIcon{#1}}\LOCALpercentchar}%
}

% Agrega un espacio vertical
%	#1	Tamaño del espacio
\newcommand{\addheaderspace}[1]{%
	\immediate\write\fileheaderitems{\unexpanded{\hspace{#1}}\LOCALpercentchar}%
}

% Agrega una imagen
%	#1	Dirección de la imagen
%	#2	Tamaño de la imagen {small, normal, large}
\newcommand{\addheaderimage}[2]{%
	\ifthenelse{\equal{#2}{small}}{%
		\immediate\write\fileheaderitems{\unexpanded{\raisebox{-0.01\baselineskip}{\includegraphics[height=0.65\baselineskip]{#1}}}\LOCALpercentchar}%
	}{%
	\ifthenelse{\equal{#2}{normal}}{%
		\immediate\write\fileheaderitems{\unexpanded{\raisebox{-0.15\baselineskip}{\includegraphics[height=1\baselineskip]{#1}}}\LOCALpercentchar}%
	}{%
	\ifthenelse{\equal{#2}{large}}{%
		\immediate\write\fileheaderitems{\unexpanded{\raisebox{-0.25\baselineskip}{\includegraphics[height=1.25\baselineskip]{#1}}}\LOCALpercentchar}%
	}{%
		\throwerror{\addheaderimage}{Tamano de la imagen debe ser: small, normal o large}}}%
	}%
}

% Escribe el encabezado del CV
\newcommand{\writeheader}{%
	% Escribe título
	\ifthenelse{\equal{\writetitleheader}{true}}{%
		\begin{center}%
			\fontsize{16}{12} \selectfont \vspace{0.3cm} \textcolor{\titlecolor}{\headertitle}%
		\end{center}%
		\vspace{\headertitlemargin cm}%
	}{}%
	
	% Nombre
	\ifthenelse{\equal{\headertitlecentered}{true}}{\begin{center}}{}%
	\noindent {\fontsizemaintitle \stylemaintitle \textcolor{\titlecolor}{\name}}%
	\ifthenelse{\equal{\writebirthdayheader}{true}}{%
		\quad \emph{\textcolor{\headertextcolor}{\birthmonth \birthday, \birthyear}}%
	}{}%
	\ifthenelse{\equal{\writelastchangeheader}{true}}{%
		\hfill \quad {\scriptsize \textcolor{\lastchangeheadercolor}{\nomlastchange\ \today}}%
	}{}%
	\\ \vspace{-1em}%
	\ifthenelse{\equal{\headertitlecentered}{true}}{\end{center}}{}%
	
	% Escribe items del header
	\hypersetup{urlcolor=\headerurlcolor}%
	\vspace{\headeritemsmargin cm}%
	{%
		\noindent%
		\input{\jobname.hitems}%
	}%
	\vspace{0.55em}%
	\hypersetup{urlcolor=\urlcolor}%
}

% Título de las secciones principales
%	#1	Título
\newcommand*{\roottitle}[1]{%
	\emptyvarerr{\roottitle}{#1}{Titulo no definido}%
	\ifthenelse{\equal{#1}{}}{}{%
		\section*{#1}\vspace{-0.3em}\nopagebreak[4]%
		\addcontentsline{toc}{section}{#1}%
	}%
}

% Calcula el margen necesario para diferentes tipos de línea
%	#1	Tipo de línea
\newcommand{\summarystylemarginprefix}[1]{%
	\ifthenelse{\equal{#1}{}}{}{%
	\ifthenelse{\equal{#1}{..}}{}{%
	\ifthenelse{\equal{#1}{none}}{%
		\vspace{-0.75em}%
		\ifthenelse{\equal{\nomsummary}{}}{%
			\vspace{2em}%
		}{%
			\vspace{1em}%
		}%
	}{}}}%
}

% Calcula el margen necesario para diferentes tipos de línea
%	#1	Tipo de línea
\newcommand{\summarystylemarginpostfix}[1]{%
	\ifthenelse{\equal{#1}{}}{%
		\ifthenelse{\equal{\nomsummary}{}}{%
			\vspace{1.5em}%
		}{}%
	}{%	
	\ifthenelse{\equal{#1}{..}}{%
		\ifthenelse{\equal{\nomsummary}{}}{%
			\vspace{0.5em}%
			\\%
		}{}%
	}{%	
	\ifthenelse{\equal{#1}{none}}{}{}}}%
}

% Crea un acrónimo de forma fácil
%	#1	Acrónimo
\newcommand*{\acr}[1]{%
	\textscale{.85}{#1}%
}

% Crea un campo de texto
% 	#1	Texto
\newcommand{\bodytext}[1]{%
	\begin{indentsection}%
		\item[] #1%
	\end{indentsection}%
}

% Crea una entrada en la tabla de datos personales
%	#1	Nombre entrada
%	#2	Datos entrada
\newcommand{\personaltableentry}[2]{%
	\ifthenelse{\equal{\GLOBALpersonaltableenabled}{true}}{}{%
		\throwwarning{La funcion \noexpand\personaltableentry no puede usarse fuera del entorno \noexpand\personaltabledata}\stop%
	}%
	\emptyvarerr{\personaltableentry}{#1}{Nombre entrada no definido}%
	\emptyvarerr{\personaltableentry}{#2}{Datos entrada no definidos}%
	\textcolor{\personaltblentcolor}{\textbf{#1:}} & #2 \\%
}

% Crea el largo horizontal del box de los títulos
\newlength\institutionentrytitle

% Inserta un objeto en un elemento institución
%	#1	Cargo
%	#2	Fecha inicial
%	#3	Fecha final
%	#4	Separador entre fechas
%	#5	Descripción
\newcommand{\newinstitutionentry}[5]{%
	\ifthenelse{\equal{\GLOBALinstitutionenabled}{true}}{}{%
		\throwwarning{Funciones \noexpand\newinstitutionentry, \noexpand\institutionentry o \noexpand\institutionentrynodate no pueden usarse fuera del entorno \noexpand\institution}\stop%
	}%
	\emptyvarerr{\newinstitutionentry}{#1}{Cargo o posición no definido}%
	\nopagebreak[4]%
	\begin{indentsectiondouble}%
		\item []%
		\noindent%
		\hfuzz=2pt%
		\def\LOCALinstitutionentrydate {%
			\ifthenelse{\equal{#2}{}}{%
				\ifthenelse{\equal{#3}{}}{}{%
					\noindent \textcolor{\datecolor}{\emph{#3}}%
				}%
			}{%
				\ifthenelse{\equal{#3}{}}{%
					\noindent \textcolor{\datecolor}{\emph{#2}}%
				}{%
					\noindent \textcolor{\datecolor}{\emph{#2 #4 #3}}%
				}%
			}%
		}%
		\printifspace{2}{%
			\settowidth\institutionentrytitle{\textbf{#1}\LOCALinstitutionentrydate} % Calcula ancho del título
			\begin{minipage}{1\linewidth}%
				\ifthenelse{\institutionentrytitle<\dimexpr0.95\linewidth}{ % Aplica crop
					\textcolor{\instentrytitlecolor}{\textbf{#1}}%
					\hfill\LOCALinstitutionentrydate \\%
					\vspace{-0.35em}%
				}{%
					\begin{minipage}[t][][t]{0.69\linewidth}%
						\textcolor{\instentrytitlecolor}{\textbf{#1}} \\%
						\vspace{-0.35em}%
					\end{minipage}%
					\begin{minipage}[t][][t]{0.31\linewidth}%
						\begin{flushright}%
							\LOCALinstitutionentrydate%
						\end{flushright}%
					\end{minipage}%
				}%
			\end{minipage}%
		}%
		\ifthenelse{\equal{#5}{}}{}{%
			\bodytext{#5}%
			\par%
			\vspace{0.5\baselineskip}%
		}%
	\end{indentsectiondouble}%
}

% Entrada en institución
%	#1	Cargo
%	#2	Fecha inicial
%	#3	Fecha final
%	#4	Descripción
\newcommand{\institutionentry}[4]{%
	\newinstitutionentry{#1}{#2}{#3}{\dateseparator}{#4}%
}

% Entrada en institución con fecha corta
%	#1	Cargo
%	#2	Fecha inicial
%	#3	Fecha final
%	#4	Descripción
\newcommand{\institutionentryshort}[4]{%
	\newinstitutionentry{#1}{#2}{#3}{\dateseparator}{#4}%
}

% Entrada en institución sin fecha
%	#1	Cargo
%	#2	Descripción
\newcommand{\institutionentrynodate}[2]{%
	\newinstitutionentry{#1}{}{}{}{#2}%
}

% Otro tipo de entrada en cvblock
%	#1	Título
%	#2	Contenido
\newcommand{\otherentry}[2]{%
	\begin{basedescript}%
		{\setlength{\leftmargin}{\doubleparindent}}%
		\item[\hspace{\newparindent}\textcolor{\otherentrytitlecolor}{\textbf{#1}}] #2%
	\end{basedescript}%
}

% Inserta un elemento en el bloque de firma
%	#1	Elemento en la firma
\newcommand{\signatureentry}[1]{%
	\texttt{\MakeUppercase{#1}} \\%
}

% Crea un bull
\newcommand{\sbullet}{%
	\ \ \raisebox{0.11em}[-1em][-1em]{\tiny $\bullet$} \ \ %
}

% Variaciones de vspace
\newcommand{\breakvspace}[1]{%
	\pagebreak[2] \vspace{#1} \pagebreak[2]%
}
\newcommand{\nobreakvspace}[1]{%
	\nopagebreak[4] \vspace{#1} \nopagebreak[4]%
}

% Apóstrofe
\newcommand{\apo}{%
	\raisebox{-.18ex}{'}{\hspace{0em}}%
}

% Inserta un texto entre comillas
\newcommand{\quotes}[1]{%
	\enquote*{#1}%
}

% Inserta un texto entre comillas y negrita
%	#1 	Texto
\newcommand{\quotesbf}[1]{%
	\quotes{\textbf{#1}}%
}

% Inserta un texto entre comillas e itálico
%	#1 	Texto
\newcommand{\quotesit}[1]{%
	\quotes{\textit{#1}}%
}

% Inserta un texto entre comillas y typewriter
%	#1 	Texto
\newcommand{\quotesttt}[1]{%
	\quotes{\texttt{#1}}%
}

% Inserta un texto entre comillas dobles
%	#1 	Texto
\newcommand{\doublequotes}[1]{%
	\enquote{#1}%
}

% Inserta un texto con el formato de enlace
% 	#1 	Enlace
\newcommand{\hreftext}[1]{%
	\ifthenelse{\equal{\fonturl}{same}}{%
		#1%
	}{%
	\ifthenelse{\equal{\fonturl}{tt}}{%
		\texttt{#1}%
	}{%
	\ifthenelse{\equal{\fonturl}{rm}}{%
		\textrm{#1}%
	}{%
	\ifthenelse{\equal{\fonturl}{sf}}{%
		\textsf{#1}%
	}{}}}}%
}

% Inserta un email con un link cliqueable
\newcommand{\insertemail}[1]{%
	\href{mailto:#1}{\hreftext{#1}}%
}

% Inserta un teléfono celular
\newcommand{\insertphone}[1]{%
	\href{tel:#1}{\hreftext{#1}}%
}

% Actualiza el padding de las celdas de las tablas
%	#1	Padding horizontal (em)
%	#2	Padding vertical (em)
\newcommand{\settablecellpadding}[2]{%
	\emptyvarerr{\settablecellpadding}{#1}{Padding horizontal no definido}%
	\emptyvarerr{\settablecellpadding}{#2}{Padding vertical no definido}%
	\setlength{\tabcolsep}{#1 em} % Horizontal
	\def\arraystretch {#2} % Vertical
}
